## 2026-02-23 — Phase 0: Transport type definitions

Created `src/transport/types.ts` with all core type definitions:
- `ConnectedClient` — internal per-connection tracking (clientId, ws, sessionId, connectedAt)
- `ClientRegistry` — dual-indexed maps (clients by ID, sessions inverse index)
- `TransportOptions` — dependency-injected watcher functions + session resolver
- `Transport` — public interface (handleOpen/Message/Close, broadcastLifecycleEvent, shutdown, counts)
- `LifecycleEvent` — discriminated union of SessionStarted | SessionStopped | SessionError

Files changed:
- `src/transport/types.ts` (new)

Notes:
- `ServerWebSocket` must be explicitly imported from `"bun"` (not globally available despite `"types": ["bun"]` in tsconfig)
- `resolveSessionPath` typed as async (`Promise<string | null>`) since `resolveSessionFile` in the API module is async
- Used `ServerWebSocket<unknown>` to match Bun's server-side WebSocket type

## 2026-02-23 — Phase 0: createTransport() factory stub

Created `src/transport/create-transport.ts` with `createTransport()` factory function:
- Accepts `TransportOptions` (dependency injection for watchSession, stopWatching, resolveSessionPath)
- Returns `Transport` interface with all methods as no-ops (stubs for later phases)
- Added `src/transport/index.ts` barrel export following project convention

Files changed:
- `src/transport/create-transport.ts` (new)
- `src/transport/index.ts` (new)

Notes:
- Followed the `createApp(deps)` factory pattern from `src/api/create-app.ts`
- Options parameter prefixed with `_` since it's unused in the stub phase
- Barrel index re-exports both runtime (`createTransport`) and all types

## 2026-02-23 — Phase 0: handleOpen connection lifecycle

Implemented `handleOpen` in `createTransport`:
- Initializes `ClientRegistry` internal state (`clients` map, `sessions` inverse map)
- Adds `wsToClientId` reverse lookup map (`ServerWebSocket` → `clientId`) for O(1) client lookup in handleMessage/handleClose
- `handleOpen` generates UUID v4 via `crypto.randomUUID()`, creates `ConnectedClient`, stores in both maps
- `getClientCount` now returns `clients.size` (was hardcoded 0)

Files changed:
- `src/transport/create-transport.ts` (modified)

Notes:
- `crypto.randomUUID()` is globally available in Bun — no import needed
- `sessions` map initialized but unused until subscribe is implemented
- `_options` parameter still unused — will be consumed when subscribe/relay logic is added
