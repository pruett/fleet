## Phase 0 — Tracer Bullet: Scaffold + GET /api/projects (2026-02-22)

Implemented the minimal Hono API layer with dependency injection and the first read route.

### What was done
- Added `hono` dependency to package.json
- Created `src/api/types.ts` — `AppDependencies`, `ControlResult`, `StartSessionOpts` interfaces
- Created `src/api/create-app.ts` — `createApp(deps)` with `GET /api/projects` route
- Created `src/api/index.ts` — barrel re-exports
- Created `src/api/__tests__/helpers.ts` — mock factories (`createMockDeps`, `createMockProject`, `createMockSession`, `createEmptyEnrichedSession`)
- Created `src/api/__tests__/create-app.test.ts` — 3 tests for GET /api/projects (happy path, basePaths forwarding, empty projects)

### Files changed
- `package.json` (added hono dep)
- `bun.lock` (updated)
- `src/api/types.ts` (new)
- `src/api/create-app.ts` (new)
- `src/api/index.ts` (new)
- `src/api/__tests__/helpers.ts` (new)
- `src/api/__tests__/create-app.test.ts` (new)

### Verification
- typecheck: pass
- tests: 424 pass, 0 fail (3 new API tests + 421 existing)

## Phase 1 — File Resolution Helpers (2026-02-22)

Added `resolveProjectDir` and `resolveSessionFile` helpers for mapping IDs to filesystem paths.

### What was done
- Created `src/api/resolve.ts` — `resolveProjectDir(basePaths, projectId)` scans each basePath for a matching directory (first-match wins); `resolveSessionFile(basePaths, sessionId)` scans basePath/{project}/sessionId.jsonl
- Created `src/api/__tests__/resolve.test.ts` — 10 tests covering happy path, not found, first-match-wins, and missing basePath resilience for both resolvers
- Created `src/api/__tests__/fixtures/` — minimal fixture dirs with empty .jsonl files for resolve tests
- Updated `src/api/index.ts` — re-exports `resolveProjectDir` and `resolveSessionFile`

### Files changed
- `src/api/resolve.ts` (new)
- `src/api/index.ts` (updated — added resolve re-exports)
- `src/api/__tests__/resolve.test.ts` (new)
- `src/api/__tests__/fixtures/resolve-base-1/` (new fixture dirs)
- `src/api/__tests__/fixtures/resolve-base-2/` (new fixture dirs)

### Verification
- typecheck: pass
- tests: 434 pass, 0 fail (10 new resolve tests + 424 existing)

## Phase 1 — GET /api/projects/:projectId/sessions (2026-02-22)

Added the sessions-per-project read route with project resolution and 404 handling.

### What was done
- Added `GET /api/projects/:projectId/sessions` route in `create-app.ts` — resolves projectId via `resolveProjectDir`, delegates to `scanner.scanSessions`, returns `{ sessions: [...] }`
- Returns 404 `{ "error": "Project not found" }` when resolution returns null
- Added 2 tests: happy path (200 with sessions + verifies resolved dir passed to scanner), project not found (404)

### Files changed
- `src/api/create-app.ts` (updated — added sessions route, imported `resolveProjectDir`)
- `src/api/__tests__/create-app.test.ts` (updated — added 2 tests for sessions route)

### Verification
- typecheck: pass
- tests: 436 pass, 0 fail (2 new route tests + 434 existing)

## Phase 1 — GET /api/sessions/:sessionId (2026-02-22)

Added the single-session read route with file resolution, Bun file reading, and parser delegation.

### What was done
- Added `GET /api/sessions/:sessionId` route in `create-app.ts` — resolves sessionId via `resolveSessionFile`, reads file with `Bun.file().text()`, delegates to `parser.parseFullSession`, returns `{ session: {...} }`
- Returns 404 `{ "error": "Session not found" }` when resolution returns null
- Added 2 tests: happy path (200 with parsed session + verifies content passed to parser), session not found (404)

### Files changed
- `src/api/create-app.ts` (updated — added session route, imported `resolveSessionFile`)
- `src/api/__tests__/create-app.test.ts` (updated — added 2 tests for session route, imported `createEmptyEnrichedSession`)

### Verification
- typecheck: pass
- tests: 438 pass, 0 fail (2 new route tests + 436 existing)

## Phase 2 — POST /api/sessions (start) (2026-02-22)

Added the start-session control route with body validation and controller delegation.

### What was done
- Added `POST /api/sessions` route in `create-app.ts` — parses JSON body, validates `projectDir` required, delegates to `controller.startSession`, returns 201 with `{ sessionId }` on success
- Returns 400 `{ "error": "projectDir is required" }` when `projectDir` is missing from body
- Returns 500 with controller error message when `result.ok` is false
- Added 3 tests: happy path (201 + verifies opts passed to controller), missing projectDir (400), controller failure (500)

### Files changed
- `src/api/create-app.ts` (updated — added POST /api/sessions route)
- `src/api/__tests__/create-app.test.ts` (updated — added 3 tests for start-session route)

### Verification
- typecheck: pass
- tests: 441 pass, 0 fail (3 new route tests + 438 existing)

## Phase 2 — POST /api/sessions/:sessionId/stop (2026-02-22)

Added the stop-session control route with controller delegation.

### What was done
- Added `POST /api/sessions/:sessionId/stop` route in `create-app.ts` — extracts sessionId param, delegates to `controller.stopSession`, returns 200 with `{ sessionId }` on success
- Returns 500 with controller error message when `result.ok` is false
- Added 2 tests: happy path (200 + verifies sessionId passed to controller), controller failure (500)

### Files changed
- `src/api/create-app.ts` (updated — added stop route)
- `src/api/__tests__/create-app.test.ts` (updated — added 2 tests for stop route)

### Verification
- typecheck: pass
- tests: 443 pass, 0 fail (2 new route tests + 441 existing)

## Phase 2 — POST /api/sessions/:sessionId/resume (2026-02-22)

Added the resume-session control route with controller delegation.

### What was done
- Added `POST /api/sessions/:sessionId/resume` route in `create-app.ts` — extracts sessionId param, delegates to `controller.resumeSession`, returns 200 with `{ sessionId }` on success
- Returns 500 with controller error message when `result.ok` is false
- Added 2 tests: happy path (200 + verifies sessionId passed to controller), controller failure (500)

### Files changed
- `src/api/create-app.ts` (updated — added resume route)
- `src/api/__tests__/create-app.test.ts` (updated — added 2 tests for resume route)

### Verification
- typecheck: pass
- tests: 445 pass, 0 fail (2 new route tests + 443 existing)

## Phase 2 — POST /api/sessions/:sessionId/message (2026-02-22)

Added the send-message control route with body validation and controller delegation.

### What was done
- Added `POST /api/sessions/:sessionId/message` route in `create-app.ts` — parses JSON body, validates `message` required, delegates to `controller.sendMessage(sessionId, message)`, returns 200 with `{ sessionId }` on success
- Returns 400 `{ "error": "message is required" }` when `message` is missing from body
- Returns 500 with controller error message when `result.ok` is false
- Added 3 tests: happy path (200 + verifies sessionId and message passed to controller), missing message (400), controller failure (500)

### Files changed
- `src/api/create-app.ts` (updated — added message route)
- `src/api/__tests__/create-app.test.ts` (updated — added 3 tests for message route)

### Verification
- typecheck: pass
- tests: 448 pass, 0 fail (3 new route tests + 445 existing)
